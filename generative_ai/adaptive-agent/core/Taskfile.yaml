---
# https://taskfile.dev
version: '3'

env:
  SRCDIR: ./src/

includes:
  common:
    taskfile: ./task-common.yaml
    internal: true

tasks:
  install:
    desc: "ğŸ”§ Install dependencies"
    cmds:
      - echo "ğŸ”§ Installing dependencies.."
      - "{{.UV_CMD}} sync --all-extras --dev"
  uninstall:
    desc: "ğŸ”§ Uninstall dependencies"
    cmds:
      - echo "ğŸ”§ Uninstalling dependencies.."
      - rm -rf .venv
  build:
    desc: "ğŸ—ï¸  Build React code"
    cmds:
      - "{{.UV_CMD}} build"
  lint:
    silent: true
    desc: "ğŸ§¹ Run linters"
    cmds:
      - echo "ğŸ§¹ Running linters.."
      - "{{.UV_CMD}} run ruff format \"$SRCDIR\""
      - "{{.UV_CMD}} run ruff check \"$SRCDIR\" --fix"
      - "{{.UV_CMD}} run mypy --pretty \"$SRCDIR\""

  lint-check:
    desc: ğŸ§¹ Check whether the codebase is linted
    cmds:
      - echo "ğŸ§¹ Linting"
      - "{{.UV_CMD}} run ruff format --check \"$SRCDIR\""
      - "{{.UV_CMD}} run ruff check \"$SRCDIR\""
      - "{{.UV_CMD}} run mypy --pretty \"$SRCDIR\""

  test:
    silent: true
    desc: "ğŸ§ª Run tests"
    cmds:
      - echo "ğŸ§ª Running tests.."
      - "{{.UV_CMD}} run pytest --cov --cov-report=html --cov-report=term --cov-report xml:.coverage.xml"
